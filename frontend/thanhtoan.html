<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh Toán - Đặt Hàng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/thanhtoan.css">
    <link rel="stylesheet" href="./css/main.css">
</head>

<body class="bg-white">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/frontend/trangchu.html">
                <i class="fas fa-bolt"></i> TechStore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">

                <div class="d-flex align-items-center ms-auto">
                    <!-- Giỏ hàng -->
                    <div class="position-relative me-3">
                        <a href="./tranggiohang.html" class="text-white position-relative" onclick="toggleCart(event)">
                            <i class="fas fa-shopping-cart fa-lg"></i>
                            <span
                                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                                id="cart-count">
                                0
                            </span>
                        </a>
                    </div>

                    <!-- User Menu -->
                    <div class="dropdown">
                        <a href="#" class="text-white dropdown-toggle d-flex align-items-center"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <img id="user-avatar" src="./img/avt.jpg" alt="avatar" class="rounded-circle me-2"
                                style="width:30px;height:30px;object-fit:cover;">
                            <span id="user-name">Tài khoản</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <!-- Khi chưa đăng nhập -->
                            <li class="not-logged-in"><a class="dropdown-item" href="#" onclick="showLogin(event)"><i
                                        class="fas fa-sign-in-alt me-2"></i>Đăng nhập</a></li>

                            <!-- Khi đã đăng nhập -->
                            <li class="logged-in d-none"><a class="dropdown-item" href="#"><i
                                        class="fas fa-user-circle me-2"></i>Tài khoản của tôi</a></li>
                            <li class="logged-in d-none"><a class="dropdown-item" href="#"><i
                                        class="fas fa-box me-2"></i>Đơn hàng của tôi</a></li>
                            <li class="logged-in d-none">
                                <hr class="dropdown-divider">
                            </li>
                            <li class="logged-in d-none"><a class="dropdown-item text-danger" href="#"
                                    onclick="logout(event)"><i class="fas fa-sign-out-alt me-2"></i>Đăng xuất</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="checkout-container">
        <div class="checkout-wrapper">
            <!-- Tiêu đề -->
            <div class="checkout-title">
                <h1>Thanh Toán Đơn Hàng</h1>
            </div>

            <div class="checkout-content">
                <!-- Cột trái: Form -->
                <div class="checkout-form-section">
                    <form id="checkoutForm">
                        <!-- Thông tin giao hàng -->
                        <div class="form-section">
                            <h2 class="section-title">1. Thông Tin Giao Hàng</h2>
                            <div class="row g-3">
                                <div class="col-12 mb-3">
                                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal"
                                        data-bs-target="#addressModal">
                                        Chọn địa chỉ khác
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Họ và tên <span class="required">*</span></label>
                                    <input type="text" class="form-control" name="fullName" id="fullName"
                                        placeholder="Nguyễn Văn A" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Số điện thoại <span class="required">*</span></label>
                                    <input type="tel" class="form-control" name="phone" id="phone"
                                        placeholder="0123456789" required>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Email <span class="required">*</span></label>
                                    <input type="email" class="form-control" name="email" id="email"
                                        placeholder="example@gmail.com" required readonly style="background-color: #e9ecef; color: #495057;">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Tỉnh/Thành phố <span class="required">*</span></label>
                                    <select class="form-select" name="province" id="province" required>
                                        <option value="">Chọn Tỉnh/TP</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Quận/Huyện <span class="required">*</span></label>
                                    <select class="form-select" name="district" id="district" required>
                                        <option value="">Chọn Quận/Huyện</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Phường/Xã <span class="required">*</span></label>
                                    <select class="form-select" name="ward" id="ward" required>
                                        <option value="">Chọn Phường/Xã</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Địa chỉ cụ thể <span class="required">*</span></label>
                                    <input type="text" class="form-control" name="address" id="address"
                                        placeholder="Số nhà, tên đường..." required>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Ghi chú đơn hàng</label>
                                    <textarea class="form-control" name="note" id="note" rows="2"
                                        placeholder="Ví dụ: Giao hàng giờ hành chính, gọi trước khi giao..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Phương thức thanh toán -->
                        <div class="form-section">
                            <h2 class="section-title">2. Phương Thức Thanh Toán</h2>
                            <div class="payment-options">
                                <!-- COD -->
                                <label class="payment-option" id="paymentCod" onclick="selectPayment('cod')">
                                    <input type="radio" name="payment" value="cod" id="cod" checked>
                                    <div class="payment-content">
                                        <div class="payment-title">Thanh toán khi nhận hàng (COD)</div>
                                        <div class="payment-desc">Thanh toán bằng tiền mặt khi nhận hàng</div>
                                    </div>
                                </label>

                                <!-- Chuyển khoản ngân hàng -->
                                <label class="payment-option" id="paymentBank" onclick="selectPayment('bank')">
                                    <input type="radio" name="payment" value="bank" id="bank">
                                    <div class="payment-content">
                                        <div class="payment-title">Chuyển khoản ngân hàng</div>
                                        <div class="payment-desc">Chuyển khoản qua ATM/Internet Banking</div>
                                    </div>
                                </label>
                            </div>

                            <!-- VNPAY: chỉ hiện khi chọn chuyển khoản ngân hàng -->
                            <div id="bankOptions" class="bank-options d-none">
                                <p class="bank-options-title">Chọn phương thức:</p>
                                <label class="payment-option">
                                    <input type="radio" name="bankMethod" value="vnpay" id="vnpay">
                                    <div class="payment-content">
                                        <div class="payment-title">Thanh toán qua VNPAY</div>
                                        <div class="payment-desc">Quét mã QR hoặc nhập thông tin thẻ</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Cột phải: Tóm tắt đơn hàng -->
                <div class="checkout-summary-section">
                    <div class="summary-card">
                        <h3 class="summary-title">Tóm Tắt Đơn Hàng</h3>

                        <!-- Danh sách sản phẩm -->
                        <div class="summary-items">
                            <div id="orderItems">
                                <!-- Sẽ được render bằng JS -->
                            </div>
                        </div>

                        <!-- Tính toán -->
                        <div class="summary-calculation">
                            <div class="calc-row">
                                <span>Tạm tính:</span>
                                <span id="subtotal">0₫</span>
                            </div>
                            <div class="calc-row">
                                <span>Phí vận chuyển:</span>
                                <span id="shippingFee">Miễn phí</span>
                            </div>
                            <div class="calc-row total">
                                <span>Tổng cộng:</span>
                                <span id="total">0₫</span>
                            </div>
                        </div>

                        <!-- Nút đặt hàng -->
                        <button type="button" class="btn-checkout" onclick="placeOrder()">
                            Xác Nhận Đặt Hàng
                        </button>
                        <p class="security-note">
                            <i class="fas fa-lock"></i> Thông tin của bạn được bảo mật
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal chọn địa chỉ -->
    <div class="modal fade" id="addressModal" tabindex="-1" aria-labelledby="addressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addressModalLabel">Chọn địa chỉ giao hàng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="addressList">
                    <!-- Danh sách địa chỉ sẽ render bằng JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./js/thanhtoan.js"></script>
    <script src="./js/main.js"></script>
    <script src="./js/pay.js"></script>
    <script>
        // Hàm xử lý chọn phương thức thanh toán
        function selectPayment(method) {
            const bankOptions = document.getElementById('bankOptions');
            const paymentCod = document.getElementById('paymentCod');
            const paymentBank = document.getElementById('paymentBank');

            if (method === 'cod') {
                document.getElementById('cod').checked = true;
                bankOptions.classList.add('d-none');
                paymentCod.classList.add('active');
                paymentBank.classList.remove('active');
            } else if (method === 'bank') {
                document.getElementById('bank').checked = true;
                bankOptions.classList.remove('d-none');
                paymentBank.classList.add('active');
                paymentCod.classList.remove('active');
            }
        }
    </script>
</body>

</html>